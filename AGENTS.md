# 项目说明

一个截屏用的工具，可以获取当前屏幕上的内容，能够保存到文件、剪贴板等地方

# 开发环境

Windows 11, C++ 20, CMake

环境为Windows简体中文版，各种工具的输出有极大概率为简体中文，编码可能是UTF-8可能是GBK，注意识别。

环境中带有 bash、python、powershell 等工具，必要时可以使用以提升工作效率

# 开发建议

类要少对外暴露内部成员，只暴露调用所需的方法。.h 中的类为虚类、方法为纯虚方法，.cpp 中实现。这样在包含 .h 的时候就不会引入不必要的头文件。

# 项目结构

## 捕捉模块

采用 Windows RT API 获取当前屏幕的一帧内容，scRGB浮点（单精度或者半精度均可）采样格式，连带宽高等元数据保存到一个对象中

## 系统信息获取模块

获取系统中当前HDR的最高亮度、SDR白点值等信息

## 预览模块

一个全屏展示的窗口，内部使用 ANGLE 进行 HDR 渲染，分为矩形选中区域和未选中区域部分，其中选中区域显示原始画面，未选中区域显示为“原始画面压缩到SDR亮度范围后、降低70%亮度”。

## 裁剪模块

允许鼠标在预览画面上操作，操作分为以下几种

### 框选

将选中区域设置为对角线的两个点为鼠标按下时的位置和鼠标当前位置组成的矩形

### 修改

如果鼠标在选中区域的矩形四个角上，则修改这个角的位置；
如果鼠标在选中区域的矩形边上，则修改这个边的位置；

### 完成选择

键盘的 Enter 键或者鼠标右键都是完成选择的操作；键盘的 ESC 是取消操作

## 输出模块

后续补充

# 开发进度记录

如果一个工作项开发完成，请勾选。需求完成后，请自动将其添加到git中提交

[x] 环境搭建，生成cmake脚本，添加空的 main.cpp，并链接到angle。依赖库在deps文件夹内，可先使用 dir /s/b 或等效命令查看
[x] 提交到git，注意deps中的二进制文件均需要使用LFS。提交的默认用户名已经设置好了，提交信息请自己生成
[x] 开发屏幕捕捉模块，参考代码已经在 refcode/ 文件夹下。我们不需要捕捉单个窗口的功能、只需要全屏幕捕捉。暂时假设显示器只有一个。保存捕捉到的结果的类请自己设计。
[x] 添加了开发建议，按照开发建议重新修改 ScreenCapture.h 和 ScreenCapture.cpp 文件。
[x] 屏幕捕捉后保存的数据为 scRGB 浮点格式的内存数据，故需要将纹理下载到内存中。
[x] 开发预览模块，在捕捉画面之后弹出一个全屏窗口，展示画面内容。使用ANGLE渲染HDR的示例代码在 refcode/ 中。
[x] 预览模块、框选模块的功能变更了，适配新的变更
[x] 程序没有声明高DPI支持导致显示的截屏很糊，需要声明高DPI支持
[x] 预览模块的功能变更了，适配新的变更
